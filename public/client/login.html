<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Login</title>
    <style>
           body {
      font-family: Arial, sans-serif;
      padding: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    btns{
          display: flex;
      align-items: center;
      justify-content: center;
    }
    </style>
</head>

<body>

    <h1>Login</h1>

    <form id="loginForm">
        <label>Email: <input type="email" id="email" required></label><br><br>
        <label>Password: <input type="password" id="password" required></label><br><br>
        <button type="submit">Login</button>
    </form>
    <a href="/">home</a>

    <script>
        async function login(e) {
            e.preventDefault();
            const tokenRes = await fetch('/server/utils/get_csrf.php');
            const { token } = await tokenRes.json();

            const payload = {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };

            const res = await fetch('/server/api/login.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': token
                },
                body: JSON.stringify(payload)
            });

            const json = await res.json();
            if (json.success) {
                window.location.href = '/client/list.html';
            } else {
                alert('Login failed: ' + (json.error || 'Unknown error'));
            }
        }

        document.getElementById('loginForm').addEventListener('submit', login);
    </script>

</body>

</html>