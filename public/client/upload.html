<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: #f5f5f5;
        }

    </style>
</head>

<body>
    <div class="upload-container">
        <h1>üìÅ File Upload</h1>

        <div class="info">
            <strong>Allowed formats:</strong> JPEG, PNG, PDF<br>
            <strong>Maximum size:</strong> 5 MB
        </div>

        <form enctype="multipart/form-data" id="uploadForm">
            <div class="file-input-wrapper">
                <input type="file" name="file" id="fileInput" accept=".jpg,.jpeg,.png,.pdf" required>
            </div>

            <div class="progress" id="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <button type="submit" id="submitBtn">Upload File</button>
        </form>

        <div class="result" id="result"></div>

        <div style="margin-top: 20px; text-align: center;">
            <a href="/">‚Üê Back to Home</a>
        </div>
    </div>

    <script>
        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const submitBtn = document.getElementById('submitBtn');
        const result = document.getElementById('result');
        const progress = document.getElementById('progress');
        const progressBar = document.getElementById('progressBar');

        // Show file info when selected
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                console.log(`Selected: ${file.name} (${sizeMB} MB)`);
            }
        });

        form.onsubmit = async (e) => {
            e.preventDefault();

            const file = fileInput.files[0];
            if (!file) {
                showResult('Please select a file', 'error');
                return;
            }

            // Check file size on client side
            if (file.size > 5 * 1024 * 1024) {
                showResult('File too large. Maximum size is 5 MB', 'error');
                return;
            }

            try {
                // Disable button and show progress
                submitBtn.disabled = true;
                submitBtn.textContent = 'Uploading...';
                progress.style.display = 'block';
                progressBar.style.width = '30%';
                result.style.display = 'none';

                // Get CSRF token
                const tokenRes = await fetch('/server/utils/get_csrf.php');
                const { token } = await tokenRes.json();
                progressBar.style.width = '50%';

                // Prepare form data
                const formData = new FormData();
                formData.append('file', file);

                // Upload file
                const res = await fetch('/api/users/upload.php', {
                    method: 'POST',
                    headers: { 'X-CSRF-Token': token },
                    body: formData
                });

                progressBar.style.width = '90%';
                const json = await res.json();
                progressBar.style.width = '100%';

                if (json.success) {
                    const details = `
                        <strong>‚úì Upload successful!</strong><br>
                        <div class="file-details">
                            <strong>Filename:</strong> ${json.filename}<br>
                            <strong>Size:</strong> ${(json.size / 1024).toFixed(2)} KB<br>
                            <strong>Type:</strong> ${json.type}
                        </div>
                    `;
                    showResult(details, 'success');
                    form.reset();
                } else {
                    showResult('Error: ' + json.error, 'error');
                }

            } catch (err) {
                console.error('Upload error:', err);
                showResult('Network error: ' + err.message, 'error');
            } finally {
                // Reset button and progress
                submitBtn.disabled = false;
                submitBtn.textContent = 'Upload File';
                setTimeout(() => {
                    progress.style.display = 'none';
                    progressBar.style.width = '0%';
                }, 1000);
            }                                                                                                                                                                                                          
        };

        function showResult(message, type) {
            result.innerHTML = message;
            result.className = 'result ' + type;
            result.style.display = 'block';
        }
    </script>
</body>

</html>                         